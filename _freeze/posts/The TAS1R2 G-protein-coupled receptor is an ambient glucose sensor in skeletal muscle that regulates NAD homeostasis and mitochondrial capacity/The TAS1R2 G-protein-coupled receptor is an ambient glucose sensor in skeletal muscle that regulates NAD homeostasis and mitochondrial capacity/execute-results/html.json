{
  "hash": "2f61f3d30e8ec3a945ea80a96f38145c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Fig 3b -- The TAS1R2 G-protein-coupled receptor is an ambient glucose sensor in skeletal muscle that regulates NAD homeostasis and mitochondrial capacity\"\nauthor: \"Jeff Walker\"\ndate: '8 June 2024'\ndate-modified: \"2024-06-09\"\ncategories: [\"linear mixed model\", \"ratio paired t-test\", \"generalized linear mixed model\", \"ggplot\"]\ndescription: \"The researchers analyzed figure 3b with a ratio paired t-test, which is a special case of a linear mixed model with a log-transformed response or a generalized linear mixed model with a Gamma distribution and log link. An advantage to fitting the LMM or GLMM is asymmetric confidence intervals of the group means that reflect the skew of the data. Plot the model!\"\ndraft: false\nformat: \n  html: \n    toc: true \n    toc-location: right\nexecute: \n  message: false\n  warning: false\neditor_options: \n  chunk_output_type: inline\nfreeze: auto\n---\n\n\n![ggplot better-than-replication of Fig 3b from the article. It's better than because the confidence intervals from the model are asymmetric and reflect the right (upward) skew of the data](../../figs/The TAS1R2 G-protein-coupled receptor is an ambient glucose sensor in skeletal muscle that regulates NAD homeostasis and mitochondrial capacity/fig3b_ggplot.png){width=4in fig-align=\"left\"}\n\n## Vital info\n\nData From: [Serrano, J., Boyd, J., Brown, I.S. et al. The TAS1R2 G-protein-coupled receptor is an ambient glucose sensor in skeletal muscle that regulates NAD homeostasis and mitochondrial capacity. Nat Commun 15, 4915 (2024). https://doi.org/10.1038/s41467-024-49100-8](https://www.nature.com/articles/s41467-024-49100-8){target=\"_blank\"}\n\nFig: 3b [download data](../../data from/The TAS1R2 G-protein-coupled receptor is an ambient glucose sensor in skeletal muscle that regulates NAD homeostasis and mitochondrial capacity/41467_2024_49100_MOESM5_ESM.xlsx){target=\"_blank\"}\n\nkey words: \n\nPublished methods: ratio paired t-test\n\nDesign: Randomized Complete Block Design (RCBD)\n\nResponse: gel intensity\n\nKey learning concepts: generalized linear mixed model\n\nMore info: [Chapter 16 Models for non-independence -- linear mixed models](https://www.middleprofessor.com/files/applied-biostatistics_bookdown/_book/lmm){target=\"_blank\"}\n\n## The experiment\n\nThe researchers engineered mice to express human TAS1R2 receptor in the muscles of muscle-specific TAS1R2 knockout (mKO) mice. Aspartame is a TAS1R2 agonist in humans but not mice. Presumably Saline was injected in muscle on one side and Aspartame on the other side of the same mouse, so mouse is a block, hence the ratio paierd *t*-test.\n\nTreatments\n\n1. Veh -- Saline? injected into mTg mice muscle\n2. Asp -- Aspartame injected into mTg mice muscle\n\n## Setup\n\n\n\n\n\n## Import and Wrangle\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_from <- \"The TAS1R2 G-protein-coupled receptor is an ambient glucose sensor in skeletal muscle that regulates NAD homeostasis and mitochondrial capacity\"\nfile_name <- \"41467_2024_49100_MOESM5_ESM.xlsx\"\nfile_path <- here(data_folder, data_from, file_name)\n\nfig3b_wide <- read_excel(file_path,\n                    sheet = \"Fig.3b\",\n                    range = \"B7:C13\",\n                    col_names = TRUE) |>\n  data.table()\nsetnames(fig3b_wide, old = names(fig3b_wide), new = c(\"Veh\", \"Asp\"))\nfig3b_wide[, mouse := paste0(\"mouse_\", .I)]\nfig3b <- melt(fig3b_wide,\n              id.vars = \"mouse\",\n              variable.name = \"genotype\",\n              value.name = \"ppar1\")\n\n# output as clean excel file\nfileout_name <- \"fig3b-RCBD-The TAS1R2 G-protein-coupled receptor is an ambient glucose sensor in skeletal muscle that regulates NAD homeostasis and mitochondrial capacity.xlsx\"\nfileout_path <- here(data_folder, data_from, fileout_name)\nwrite_xlsx(fig3b, fileout_path)\n```\n:::\n\n\n\n## Fit the model\n\nThe paired t-test is a special case of a linear mixed model -- specifically a linear mixed model with a single fixed factor and a single random intercept. For the ratio paired t-test, simply fit the model to the log transformed response.\n\nFor this experiment, `genotype` is the fixed factor, and `mouse` is the block, so will be fit as a random factor. Note that I include the log transorm in the model formula, which signals the emmeans package to report the results on the response scale, which makes the treatment effect a ratio instead of a log ratio.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlmm1 <- lmer(log(ppar1) ~ genotype + (1 | mouse),\n             data = fig3b)\n```\n:::\n\n\n## The linear mixed model results replicate the published results\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlmm1_emm <- emmeans(lmm1,\n                     specs =\"genotype\",\n                     type = \"response\")\nlmm1_pairs <- contrast(lmm1_emm,\n                        method =\"revpairwise\") |>\n  summary(infer = TRUE)\nlmm1_pairs\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n contrast  ratio    SE df lower.CL upper.CL null t.ratio p.value\n Asp / Veh  2.05 0.434  5     1.19     3.53    1   3.386  0.0195\n\nDegrees-of-freedom method: kenward-roger \nConfidence level used: 0.95 \nIntervals are back-transformed from the log scale \nTests are performed on the log scale \n```\n\n\n:::\n:::\n\n\nThe treatment effect (\"ratio\") is the geometric mean (not the mean!) of the ratios Asp/Veh. Ratios are nice for interpretation: p-PAR1 levels in the Aspartame treatment are 2.05 times the levels in the Vehicle treatment.\n\nThe effect (ratio of Asp/Veh), confidence interval, and p-value from the LMM are the same as in the archived table shown below.\n\n![Excel table from the archived data file](../../figs/The TAS1R2 G-protein-coupled receptor is an ambient glucose sensor in skeletal muscle that regulates NAD homeostasis and mitochondrial capacity/fig3b-table.png){width=3in fig-align=\"left\"}\n\n## Plot the model!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlmm1_emm_dt <- summary(lmm1_emm) |>\n  data.table()\nlmm1_pairs_dt <- lmm1_pairs |>\n  data.table()\n\ngg <- ggplot(data = fig3b,\n             aes(x = genotype,\n                 y = ppar1,\n                 color = genotype)) +\n  geom_jitter(width = 0.1,\n                show.legend = FALSE) +\n  geom_point(data = lmm1_emm_dt,\n                aes(x = genotype,\n                    y = response),\n                size = 3,\n                show.legend = FALSE) +\n  geom_errorbar(data = lmm1_emm_dt,\n                aes(x = genotype,\n                    y = response,\n                    ymin = lower.CL,\n                    ymax = upper.CL),\n                width = 0.05,\n                show.legend = FALSE) +\n  ylab(\"p-PAR1\") +\n  scale_color_manual(values = pal_okabe_ito_2) +\n  theme_pubr() +\n  theme(axis.title.x = element_blank()) +\n  NULL\n\n  # add p-values\nlmm1_pairs_dt[, group1 := \"Veh\"]\nlmm1_pairs_dt[, group2 := \"Asp\"]\nlmm1_pairs_dt[, p := p.value |>\n              p_round(digits = 2) |>\n              p_format(digits = 2, accuracy = 1e-04, add.p = TRUE)]\nmaxy <- fig3b[, max(ppar1)]\nminy <- fig3b[, min(ppar1)]\nlmm1_pairs_dt[, y.position := maxy + 0.05*(maxy - miny)]\n\ngg <- gg +\n  stat_pvalue_manual(\n    data = lmm1_pairs_dt,\n    label = \"p\",\n    tip.length = 0.001)\n\ngg\n```\n\n::: {.cell-output-display}\n![](The-TAS1R2-G-protein-coupled-receptor-is-an-ambient-glucose-sensor-in-skeletal-muscle-that-regulates-NAD-homeostasis-and-mitochondrial-capacity_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n::: {.callout-note}\nNote the asymetric intervals! This is because the intevals were computed on the log-transformed values and then backtransformed to the scale of the response.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsave_it <- FALSE\nif(save_it){\nout_fig <- \"fig3b_ggplot.png\"\nout_path <- here(\"figs\", data_from, out_fig)\nggsave(out_path)\n}\n```\n:::\n\n\n## The ratio paired *t*-test\n\nThe ratio paired *t*-test is a one-sample t-test of the log of the Asp/Veh ratios. For a null hypothesis of no effect, we expect the geometric mean of the ratios to be 1, so the log of this to be 0.\n\n\n::: {.cell}\n\n```{.r .cell-code}\na <- fig3b[genotype == \"Veh\", ppar1]\nb <- fig3b[genotype == \"Asp\", ppar1]\nlog_ba <- log(b/a)\nt.test(log_ba, mu = 0)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tOne Sample t-test\n\ndata:  log_ba\nt = 3.3863, df = 5, p-value = 0.01954\nalternative hypothesis: true mean is not equal to 0\n95 percent confidence interval:\n 0.1727216 1.2613696\nsample estimates:\nmean of x \n0.7170456 \n```\n\n\n:::\n:::\n\n\nThese are the same values as the archived values and the results from the linear mixed model above.\n\n## The ratio paired t-test is just a paired t-test of the log-transformed response\n\nThis was implied above but here are the results to verify this.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlog_a <- fig3b[genotype == \"Veh\", ppar1] |>\n  log()\nlog_b <- fig3b[genotype == \"Asp\", ppar1] |>\n  log()\nt.test(log_b, log_a, paired = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPaired t-test\n\ndata:  log_b and log_a\nt = 3.3863, df = 5, p-value = 0.01954\nalternative hypothesis: true mean difference is not equal to 0\n95 percent confidence interval:\n 0.1727216 1.2613696\nsample estimates:\nmean difference \n      0.7170456 \n```\n\n\n:::\n:::\n\n\n\n## A generalized linear mixed model is a more modern way of analyzing these data\n\nIntensity levels often have a non-Normal distribution that is characterized by a right skew and a variance that increases with the mean (you can see this even with the small sample in Fig 3b. A modern way to analyze data like this is a generalized linear model, or, since we have a RBCD, a generalized linear mixed model.\n\nHere, I fit a GLMM using the Gamma distribution, which is useful for continuous, positive data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglmm1 <- glmmTMB(ppar1 ~ genotype + (1 | mouse),\n                 family = Gamma(link=\"log\"),\n                 data = fig3b)\n\nglmm1_emm <- emmeans(glmm1,\n                     specs =\"genotype\",\n                     type = \"response\")\nglmm1_pairs <- contrast(glmm1_emm,\n                        method =\"revpairwise\") |>\n  summary(infer = TRUE)\nglmm1_pairs\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n contrast  ratio    SE  df asymp.LCL asymp.UCL null z.ratio p.value\n Asp / Veh  2.05 0.398 Inf       1.4         3    1   3.715  0.0002\n\nConfidence level used: 0.95 \nIntervals are back-transformed from the log scale \nTests are performed on the log scale \n```\n\n\n:::\n:::\n\n\nHuh. This is equivalent to the LMM/ratio paired t-test, except its an \"asymptotic test\", so the p-value is optimistic and the confidence interval is narrow.\n\nI was expecting the effect to be the ratio of the means and not geometric mean of the ratios. This would have been the case with a GLM without the random intercept -- see below, but first, here are the different means (expand the code block to see what each is)\n\n\n::: {.cell}\n\n```{.r .cell-code}\na <- fig3b[genotype == \"Veh\", ppar1]\nb <- fig3b[genotype == \"Asp\", ppar1]\nmean(b)/mean(a) # ratio of means\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1.99065\n```\n\n\n:::\n\n```{.r .cell-code}\nexp(log(mean(b)) - log(mean(a))) # difference of log transformed means backtransformed = \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1.99065\n```\n\n\n:::\n\n```{.r .cell-code}\nexp(mean(log(b)) - mean(log(a))) # means of log transformed data backtransformed = geometric mean\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 2.048372\n```\n\n\n:::\n\n```{.r .cell-code}\nprod(b/a)^(1/length(b/a)) # geometric mean computation 1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 2.048372\n```\n\n\n:::\n\n```{.r .cell-code}\nexp(mean(log(b/a))) # geometric mean computation 2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 2.048372\n```\n\n\n:::\n:::\n\nAnd here is the GLM to show that the effect is the ratio of means\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglmm0 <- glmmTMB(ppar1 ~ genotype,\n                 family = Gamma(link=\"log\"),\n                 data = fig3b)\n\nglmm0_emm <- emmeans(glmm0,\n                     specs =\"genotype\",\n                     type = \"response\")\nglmm0_pairs <- contrast(glmm0_emm,\n                        method =\"revpairwise\") |>\n  summary(infer = TRUE)\nglmm0_pairs\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n contrast  ratio    SE  df asymp.LCL asymp.UCL null z.ratio p.value\n Asp / Veh  1.99 0.702 Inf     0.998      3.97    1   1.953  0.0508\n\nConfidence level used: 0.95 \nIntervals are back-transformed from the log scale \nTests are performed on the log scale \n```\n\n\n:::\n:::\n",
    "supporting": [
      "The-TAS1R2-G-protein-coupled-receptor-is-an-ambient-glucose-sensor-in-skeletal-muscle-that-regulates-NAD-homeostasis-and-mitochondrial-capacity_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}