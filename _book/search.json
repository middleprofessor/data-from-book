[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Data From – The Book",
    "section": "",
    "text": "Preface\nThis is a Quarto book.\nTo learn more about Quarto books visit https://quarto.org/docs/books.\n\n\nCode\n1 + 1\n\n\n[1] 2"
  },
  {
    "objectID": "intro.html",
    "href": "intro.html",
    "title": "1  Introduction",
    "section": "",
    "text": "This is a book created from markdown and executable code.\nSee Knuth (1984) for additional discussion of literate programming.\n\n\nCode\n1 + 1\n\n\n[1] 2\n\n\n\n\n\n\nKnuth, Donald E. 1984. “Literate Programming.” Comput. J. 27 (2): 97–111. https://doi.org/10.1093/comjnl/27.2.97."
  },
  {
    "objectID": "summary.html",
    "href": "summary.html",
    "title": "2  Summary",
    "section": "",
    "text": "In summary, this book has no content whatsoever.\n\n\nCode\n1 + 1\n\n\n[1] 2"
  },
  {
    "objectID": "sections/independence/FOXO1-is-a-master-regulator-of-memory-programming-in-CAR-T-cells.html#background",
    "href": "sections/independence/FOXO1-is-a-master-regulator-of-memory-programming-in-CAR-T-cells.html#background",
    "title": "3  FOXO1 is a master regulator of memory programming in CAR T cells",
    "section": "3.1 Background",
    "text": "3.1 Background\nSource article: FOXO1 is a master regulator of memory programming in CAR T cells\nFig: 4h\nPublished methods: t-test\nDesign: CRDS\nKey learning concepts: pseudoreplication\nComments: The researchers measure gene set expression levels in thousands of cells from mice assigned to two treatments, with five mice in each treatment. Cells from all mice within a treatment were pooled. The t-test assumes independent errors of all expression level scores but the scores of the different cells within a mouse are not independent – these are technical replicates or subsampled replicates – so the scores will be clustered (a clinical research term) or batched (a bench biology term) where each mouse is the cluster or batch.\nTL;DR: The experiment, as designed, is a waste of time and money because small p-values are almost guaranteed even if there is no true difference in expression level.\nBetter than TL;DR: This design will result in extremely small p-values for very small, and possibly biologically meaningless, effect sizes, which is likely to result in researchers pursuing research paths with trivial consequences for mouse health."
  },
  {
    "objectID": "sections/independence/FOXO1-is-a-master-regulator-of-memory-programming-in-CAR-T-cells.html#setup",
    "href": "sections/independence/FOXO1-is-a-master-regulator-of-memory-programming-in-CAR-T-cells.html#setup",
    "title": "3  FOXO1 is a master regulator of memory programming in CAR T cells",
    "section": "3.2 Setup",
    "text": "3.2 Setup\n\n\nCode\nknitr::opts_chunk$set(echo = TRUE)\n\n# wrangling packages\nlibrary(here) # here makes a project transportable\n\n\nhere() starts at /Users/walker/Documents/Github/data-from-book\n\n\nCode\nlibrary(janitor) # clean_names\n\n\n\nAttaching package: 'janitor'\n\n\nThe following objects are masked from 'package:stats':\n\n    chisq.test, fisher.test\n\n\nCode\nlibrary(readxl) # read excel, duh!\nlibrary(writexl) # write excel, duh!\nlibrary(data.table) # magical data frames\nlibrary(magrittr) # pipes\nlibrary(stringr) # string functions\nlibrary(forcats) # factor functions\n\n# analysis packages\nlibrary(emmeans) # the workhorse for inference\nlibrary(nlme) # gls and some lmm\nlibrary(lme4) # linear mixed models\n\n\nLoading required package: Matrix\n\n\n\nAttaching package: 'lme4'\n\n\nThe following object is masked from 'package:nlme':\n\n    lmList\n\n\nCode\nlibrary(lmerTest) # linear mixed model inference\n\n\n\nAttaching package: 'lmerTest'\n\n\nThe following object is masked from 'package:lme4':\n\n    lmer\n\n\nThe following object is masked from 'package:stats':\n\n    step\n\n\nCode\nlibrary(afex) # ANOVA linear models\n\n\n************\nWelcome to afex. For support visit: http://afex.singmann.science/\n\n\n- Functions for ANOVAs: aov_car(), aov_ez(), and aov_4()\n- Methods for calculating p-values with mixed(): 'S', 'KR', 'LRT', and 'PB'\n- 'afex_aov' and 'mixed' objects can be passed to emmeans() for follow-up tests\n- NEWS: emmeans() for ANOVA models now uses model = 'multivariate' as default.\n- Get and set global package options with: afex_options()\n- Set orthogonal sum-to-zero contrasts globally: set_sum_contrasts()\n- For example analyses see: browseVignettes(\"afex\")\n************\n\n\n\nAttaching package: 'afex'\n\n\nThe following object is masked from 'package:lme4':\n\n    lmer\n\n\nCode\nlibrary(glmmTMB) # generalized linear models\n\n\nWarning in checkMatrixPackageVersion(): Package version inconsistency detected.\nTMB was built with Matrix version 1.5.3\nCurrent Matrix version is 1.5.1\nPlease re-install 'TMB' from source using install.packages('TMB', type = 'source') or ask CRAN for a binary version of 'TMB' matching CRAN's 'Matrix' package\n\n\nWarning in checkDepPackageVersion(dep_pkg = \"TMB\"): Package version inconsistency detected.\nglmmTMB was built with TMB version 1.9.1\nCurrent TMB version is 1.9.2\nPlease re-install glmmTMB from source or restore original 'TMB' package (see '?reinstalling' for more information)\n\n\nCode\nlibrary(MASS) # negative binomial and some other functions\nlibrary(car) # model checking and ANOVA\n\n\nLoading required package: carData\n\n\nCode\nlibrary(DHARMa) # model checking\n\n\nThis is DHARMa 0.4.6. For overview type '?DHARMa'. For recent changes, type news(package = 'DHARMa')\n\n\nCode\nlibrary(mvtnorm)\n\n# graphing packages\nlibrary(ggsci) # color palettes\nlibrary(ggpubr) # publication quality plots\n\n\nLoading required package: ggplot2\n\n\nCode\nlibrary(ggforce) # better jitter\nlibrary(cowplot) # combine plots\n\n\n\nAttaching package: 'cowplot'\n\n\nThe following object is masked from 'package:ggpubr':\n\n    get_legend\n\n\nCode\nlibrary(knitr) # kable tables\nlibrary(kableExtra) # kable_styling tables\n\n# ggplot_the_model.R packages not loaded above\nlibrary(insight)\n\n\n\nAttaching package: 'insight'\n\n\nThe following object is masked from 'package:janitor':\n\n    clean_names\n\n\nCode\nlibrary(lazyWeave)\n\n# use here from the here package\nhere &lt;- here::here\n# use clean_names from the janitor package\nclean_names &lt;- janitor::clean_names\n# use transpose from data.table\ntranspose &lt;- data.table::transpose\n\n# load functions used by this text written by me\n# ggplot_the_model.R needs to be in the folder \"R\"\n# if you didn't download this and add to your R folder in your\n# project, then this line will cause an error\nsource_path &lt;- here(\"R\", \"ggplot_the_model.R\")\nsource(source_path)\n\n\n\nAttaching package: 'rstatix'\n\n\nThe following object is masked from 'package:MASS':\n\n    select\n\n\nThe following object is masked from 'package:janitor':\n\n    make_clean_names\n\n\nThe following object is masked from 'package:stats':\n\n    filter\n\n\nCode\ndata_folder &lt;- \"data\"\nimage_folder &lt;- \"images\"\noutput_folder &lt;- \"output\"\n\n\nThe data are gene set expression scores in units of log10 fold change"
  },
  {
    "objectID": "sections/independence/FOXO1-is-a-master-regulator-of-memory-programming-in-CAR-T-cells.html#fig-4h",
    "href": "sections/independence/FOXO1-is-a-master-regulator-of-memory-programming-in-CAR-T-cells.html#fig-4h",
    "title": "3  FOXO1 is a master regulator of memory programming in CAR T cells",
    "section": "3.3 Fig 4h",
    "text": "3.3 Fig 4h\n\n\nCode\n# data_from &lt;- \"FOXO1 is a master regulator of memory programming in CAR T cells\"\nfile_name &lt;- \"FOXO1 is a master regulator of memory programming in CAR T cells.xlsx\"\nfile_path &lt;- here(data_folder, file_name)\n\nfig4h_wide &lt;- read_excel(file_path,\n                    sheet = \"Figure 4i\",\n                    range = \"A4:h7659\",\n                    col_names = TRUE) |&gt;\n  data.table()\nsetnames(fig4h_wide,\n         old = names(fig4h_wide),\n         new = c(\"tNGFR_teff\", \"FOXO1OE_teff\", \"x1\",\n                 \"tNGFR_trm\", \"FOXO1OE_trm\", \"x2\",\n                 \"tNGFR_bulk\", \"FOXO1OE_bulk\"))\nfig4h_wide &lt;- fig4h_wide[, .SD, .SDcols = c(\"tNGFR_teff\", \"FOXO1OE_teff\",\n                                            \"tNGFR_trm\", \"FOXO1OE_trm\",\n                                            \"tNGFR_bulk\", \"FOXO1OE_bulk\")]\nfig4h &lt;- melt(fig4h_wide,\n             measure.vars = list(c(\"tNGFR_teff\", \"FOXO1OE_teff\"),\n                                 c(\"tNGFR_trm\", \"FOXO1OE_trm\"),\n                                 c(\"tNGFR_bulk\", \"FOXO1OE_bulk\")),\n             variable.name = \"treatment_code\",\n             value.name = c(\"teff\", \"trm\", \"bulk\"))\nfig4h[, treatment := ifelse(treatment_code == 1, \"tNGFR\", \"FOXO1OE\") |&gt;\n       factor(levels = c(\"tNGFR\", \"FOXO1OE\"))]\n\n\n\n\nCode\nfig4h_long &lt;- melt(fig4h,\n                  id.vars = \"treatment\",\n                  measure.vars = c(\"teff\", \"trm\", \"bulk\"),\n                  variable.name = \"response\",\n                  value.name = \"score\")\nfig4h_summary &lt;- fig4h_long[!is.na(score), .(N = .N,\n                                mean = mean(score, na.rm = TRUE),\n                              sd = sd(score, na.rm = TRUE)),\n                          by = .(treatment, response)]\nfig4h_summary\n\n\n   treatment response    N       mean        sd\n1:     tNGFR     teff 7346 0.28000025 0.3316027\n2:   FOXO1OE     teff 7655 0.49872865 0.3273944\n3:     tNGFR      trm 7346 0.03089631 0.2022660\n4:   FOXO1OE      trm 7655 0.10546725 0.1927693\n5:     tNGFR     bulk 7346 0.37863835 0.1155603\n6:   FOXO1OE     bulk 7655 0.44780623 0.1036504\n\n\n\n\nCode\nm1_teff &lt;- lm(teff ~ treatment, data = fig4h)\n#coef(summary(m1_teff))\nstats_table &lt;- data.table(\n  Response = \"TEFF\",\n  Difference = coef(summary(m1_teff))[2, 1],\n  \"Fold Change\" = 10^coef(summary(m1_teff))[2, 1],\n  Cohen = coef(summary(m1_teff))[2, 1]/summary(m1_teff)$sigma\n)\n\nm1_trm &lt;- lm(trm ~ treatment, data = fig4h)\nstats_table &lt;- rbind(stats_table,\n                     data.table(\n                       Response = \"TRM\",\n                       Difference = coef(summary(m1_trm))[2, 1],\n                       \"Fold Change\" = 10^coef(summary(m1_trm))[2, 1],\n                       Cohen = coef(summary(m1_trm))[2, 1]/summary(m1_trm)$sigma\n                     )\n)\n\nm1_bulk &lt;- lm(bulk ~ treatment, data = fig4h)\nstats_table &lt;- rbind(stats_table,\n                     data.table(\n                       Response = \"Bulk\",\n                       Difference = coef(summary(m1_bulk))[2, 1],\n                       \"Fold Change\" = 10^coef(summary(m1_bulk))[2, 1],\n                       Cohen = coef(summary(m1_bulk))[2, 1]/summary(m1_bulk)$sigma\n                     )\n)\nstats_table |&gt;\n  kable(digits = c(1,3,2,2)) |&gt;\n  kable_styling()\n\n\n\n\n\nResponse\nDifference\nFold Change\nCohen\n\n\n\n\nTEFF\n0.219\n1.65\n0.66\n\n\nTRM\n0.075\n1.19\n0.38\n\n\nBulk\n0.069\n1.17\n0.63"
  },
  {
    "objectID": "sections/independence/FOXO1-is-a-master-regulator-of-memory-programming-in-CAR-T-cells.html#cis-and-p-values",
    "href": "sections/independence/FOXO1-is-a-master-regulator-of-memory-programming-in-CAR-T-cells.html#cis-and-p-values",
    "title": "3  FOXO1 is a master regulator of memory programming in CAR T cells",
    "section": "3.4 CIs and P-values",
    "text": "3.4 CIs and P-values\n\n\nCode\nset.seed(1)\nn_reps &lt;- 2000\nt_out &lt;- matrix(as.numeric(NA), nrow = n_reps, ncol = 3)\ncolnames(t_out) &lt;- c(\"TEFF\", \"TRM\", \"Bulk\")\n\ntngfr_teff &lt;- fig4h[treatment == \"tNGFR\", teff] |&gt;\n  na.omit()\nfox_teff &lt;- fig4h[treatment == \"FOXO1OE\", teff] |&gt;\n  na.omit()\ntngfr_trm &lt;- fig4h[treatment == \"tNGFR\", trm] |&gt;\n  na.omit()\nfox_trm &lt;- fig4h[treatment == \"FOXO1OE\", trm] |&gt;\n  na.omit()\ntngfr_bulk &lt;- fig4h[treatment == \"tNGFR\", bulk] |&gt;\n  na.omit()\nfox_bulk &lt;- fig4h[treatment == \"FOXO1OE\", bulk] |&gt;\n  na.omit()\n\nfor(i in 1:n_reps){\n  t_out[i, \"TEFF\"] &lt;- t.test(sample(tngfr_teff, 5, replace = TRUE),\n                      sample(fox_teff, 5, replace = TRUE),\n                      equal.var = TRUE)$estimate |&gt; diff()\n  t_out[i, \"TRM\"] &lt;- t.test(sample(tngfr_trm, 5, replace = TRUE),\n                      sample(fox_trm, 5, replace = TRUE),\n                      equal.var = TRUE)$estimate |&gt; diff()\n  t_out[i, \"Bulk\"] &lt;- t.test(sample(tngfr_bulk, 5, replace = TRUE),\n                      sample(fox_bulk, 5, replace = TRUE),\n                      equal.var = TRUE)$estimate |&gt; diff()\n \n}\n\nci &lt;- function(x){\n  return(quantile(x, c(0.025, 0.975)))\n}\n\napply(t_out, 2, ci)\n\n\n            TEFF        TRM        Bulk\n2.5%  -0.2012789 -0.1706279 -0.06551614\n97.5%  0.6355825  0.3102888  0.20274061\n\n\nCode\nlt0 &lt;- function(x){\n  return(sum(x &lt; 0))\n}\n\napply(t_out, 2, lt0)/n_reps\n\n\n  TEFF    TRM   Bulk \n0.1430 0.2725 0.1450"
  },
  {
    "objectID": "sections/independence/FOXO1-is-a-master-regulator-of-memory-programming-in-CAR-T-cells.html#p-values-as-a-function-of-relative-magnitudes-of-within-mouse-vs-among-mouse-variation",
    "href": "sections/independence/FOXO1-is-a-master-regulator-of-memory-programming-in-CAR-T-cells.html#p-values-as-a-function-of-relative-magnitudes-of-within-mouse-vs-among-mouse-variation",
    "title": "3  FOXO1 is a master regulator of memory programming in CAR T cells",
    "section": "3.5 P-values as a function of relative magnitudes of within mouse vs among mouse variation",
    "text": "3.5 P-values as a function of relative magnitudes of within mouse vs among mouse variation\n\n\nCode\nset.seed(1)\nn_reps &lt;- 2000\nn &lt;- 5\nn_ss &lt;- 1500\nsigma_total &lt;- summary(m1_teff)$sigma # estimated SD for TEFF\ndelta &lt;- .219 # observed difference for TEFF\nicc_vec &lt;- c(0.001, 0.005, 0.01, 0.02, 0.05, 0.1, 0.2, 0.3, 0.5, 0.75)\nt &lt;- numeric(n_reps)\ntable_out &lt;- data.table(NULL)\n#sigma_a^2: the variance among mice\n#sigma_e^2: the error variance (within mice)\nfor(sim_i in 1:length(icc_vec)){\n  icc &lt;- icc_vec[sim_i]\n  # icc = sigma_a^2/sigma_total^2\n  sigma_a &lt;- sqrt(icc * sigma_total^2)\n  # sigma_total^2 = sigma_a^2 + sigma_e^2\n  sigma_e &lt;- sqrt(sigma_total^2 - sigma_a^2)\n  for(rep_i in 1:n_reps){\n    tngfr_means &lt;- rnorm(n, sd = sigma_a) \n    fox_means &lt;- rnorm(n, sd = sigma_a) + delta \n    # slow\n    tngfr &lt;- rnorm(n * n_ss, mean = rep(tngfr_means, each = n_ss), sd = sigma_e) |&gt;\n      matrix(nrow = n_ss, ncol = n) |&gt;\n      apply(2, mean)\n    fox &lt;- rnorm(n * n_ss, mean = rep(fox_means, each = n_ss), sd = sigma_e) |&gt;\n      matrix(nrow = n_ss, ncol = n) |&gt;\n      apply(2, mean)\n    # fast shortcut since the estimated mean will be so close to true mean\n    # tngfr &lt;- tngfr_means\n    # fox &lt;- fox_means\n\n    t[rep_i] &lt;- t.test(tngfr, fox, var.equal = TRUE)$statistic\n  }\n  table_out &lt;- rbind(\n    table_out,\n    data.table(\n      icc = icc,\n      t = mean(t)\n    )\n  )\n  \n}\n\ntable_out[, p := 2 * pt(t, df = n * 2 - 2, lower.tail = TRUE)]\n\nggplot(data = table_out,\n       aes(x = icc,\n           y = p)) +\n  geom_line()"
  },
  {
    "objectID": "sections/independence/FOXO1-is-a-master-regulator-of-memory-programming-in-CAR-T-cells.html#type-i-error-rates-as-a-function-of-relative-magnitudes-of-within-mouse-vs-among-mouse-variation",
    "href": "sections/independence/FOXO1-is-a-master-regulator-of-memory-programming-in-CAR-T-cells.html#type-i-error-rates-as-a-function-of-relative-magnitudes-of-within-mouse-vs-among-mouse-variation",
    "title": "3  FOXO1 is a master regulator of memory programming in CAR T cells",
    "section": "3.6 Type I error rates as a function of relative magnitudes of within mouse vs among mouse variation",
    "text": "3.6 Type I error rates as a function of relative magnitudes of within mouse vs among mouse variation\n\n\nCode\nset.seed(1)\nn_reps &lt;- 2000\nn &lt;- 5\nn_ss &lt;- 1500\nsigma_total &lt;- summary(m1_teff)$sigma\nicc_vec &lt;- c(0, 0.001, 0.005, 0.01, 0.02, 0.05, 0.1, 0.2, 0.3, 0.5, 0.75)\np &lt;- numeric(n_reps)\ntable_out &lt;- data.table(NULL)\n#sigma_a^2: the variance among mice\n#sigma_e^2: the error variance (within mice)\nfor(sim_i in 1:length(icc_vec)){\n  icc &lt;- icc_vec[sim_i]\n  # icc = sigma_a^2/sigma_total^2\n  sigma_a &lt;- sqrt(icc * sigma_total^2)\n  # sigma_total^2 = sigma_a^2 + sigma_e^2\n  sigma_e &lt;- sqrt(sigma_total^2 - sigma_a^2)\n  for(rep_i in 1:n_reps){\n    mean_vec &lt;- rep(rnorm(n, sd = sigma_a), each = n_ss)\n    samp_1 &lt;- rnorm(n * n_ss, mean = mean_vec, sd = sigma_e)\n    mean_vec &lt;- rep(rnorm(n, sd = sigma_a), each = n_ss)\n    samp_2 &lt;- rnorm(n * n_ss, mean = mean_vec, sd = sigma_e)\n    p[rep_i] &lt;- t.test(samp_1, samp_2, var.equal = TRUE)$p.value\n  }\n  table_out &lt;- rbind(\n    table_out,\n    data.table(\n      icc = icc,\n      Type_I = sum(p &lt; 0.05)/n_reps\n    )\n  )\n  \n}\n\nggplot(data = table_out,\n       aes(x = icc,\n           y = Type_I)) +\n  geom_line()"
  },
  {
    "objectID": "references.html",
    "href": "references.html",
    "title": "References",
    "section": "",
    "text": "Knuth, Donald E. 1984. “Literate Programming.” Comput.\nJ. 27 (2): 97–111. https://doi.org/10.1093/comjnl/27.2.97."
  }
]